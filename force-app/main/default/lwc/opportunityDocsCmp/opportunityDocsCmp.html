<template>
    <template if:true={isModalOpen}>
        <div class="demo-only" style="height: 640px;">
            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                <div class="slds-modal__container">
                    <header class="slds-modal__header">
                        <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">Richiedi Approvazione</h2>
                    </header>

                    <div class="slds-modal__content slds-p-around_large" id="modal-content-id-1">
                        <div if:false={disableRichiedi}><h2><b>Sei sicuro di voler procedere?</b></h2><br/></div>
                        
                        <template if:true={showSpinner}>
                            <div class="slds-text-body_small slds-text-color_error slds-align_absolute-center">Caricamento...
                                <img src="/auraFW/resources/aura/images/spinner.gif" class="spinner-img" alt="Loading" />
                            </div>
                        </template>
                    </div>

                    <footer class="slds-modal__footer">
                        <lightning-button label="Chiudi" variant="destructive" onclick={closeModal}></lightning-button>&nbsp;&nbsp;&nbsp;&nbsp;
                        <lightning-button if:false={messageNDG} label="Conferma" variant="success" disabled={disableRichiedi} onclick={getNDG}></lightning-button>
                    </footer>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </div>
    </template>

  <template for:each={uniqueArray} for:item="element">
    <h3 if:true={element.value.titleCondition} key={element.value.Id} slot="title" class="p-document-block-name slds-align_absolute-center">{element.value.Document_Block__c}</h3>
    <div class="c-container" key={element.key}>
      <div class="slds-grid">
          <div  class="slds-max-large-size_1-of-12">
              <h2 if:true={element.value.isDocTypeMandatory} class="editObb">*</h2>
          </div>
          <div class="slds-size_11-of-12 slds-float_left">
            <p class="p-document-name slds-m-around_x-small">&nbsp;{element.value.Name}</p>
          </div>
      </div>

      <div>
          <div if:true={element.value.showButtons}>
              <c-upload-files document-type-id={element.value.Id}
                              record-id={recordId}
                              is-upload-disabled={element.value.isUploadDisabled}
                              onuploadfinished={handleUploadFinished}>
              </c-upload-files>
          </div>

        <div>
          <br>
          <c-document-list document-type-id={element.value.Id}
                           all-docs-map={documentMap}
                           onvaluechanged={handleVerificaSalesSupportChanged}>
          </c-document-list>
        </div>

        <div class="slds-grid">
          <div class="slds-col slds-size_1-of-12 slds-col slds-p-around_small center-icon"></div>

          <div class="slds-col slds-size_4-of-12 slds-p-vertical_small slds-p-right_small">
            <lightning-textarea class="textareaUpload"
                                data-id={element.value.Id}
                                disabled={element.value.isCommentAreaDisabled}
                                name=commentTxtBox
                                value={element.value.commentFromDocuments}
                                label={element.value.labelComment}
                                max-length="500"
                                message-when-too-long="E' consentito inserire massimo 140 caratteri nella nota."
                                placeholder={element.value.placeComment} >
            </lightning-textarea>
          </div>

          <div class="slds-col slds-size_4-of-12 slds-p-top_medium slds-p-right_small slds-align_absolute-right slds-size_small" ></div>

          <div class="slds-col slds-size_3-of-12 slds-p-top_x-large slds-p-right_small slds-align_absolute-right slds-size_small">
              <lightning-input label={element.value.verificaGlobaleLabel}
                               name=verificaGlobaleTxtBox
                               data-id={element.value.Id}
                               value={element.value.verificaGlobale}
                               type="text"
                               read-only>
              </lightning-input>
          </div>
        </div>

        <div class="slds-grid">
          <div class="slds-col slds-size_1-of-12 slds-p-around_small"></div>

          <div class="slds-col slds-size_2-of-12 slds-p-vertical_small slds-p-right_small slds-m-right_x-small">
            <lightning-button  if:false={element.value.isCommentAreaDisabled}
                               disabled={element.value.disableSalvaButton}
                               data-id={element.value.Id}
                               label="SALVA"
                               onclick={updateCommentFieldInDocuments}
                               name="salvaBtn"
                               class="button-save">
            </lightning-button>
          </div>

          <div class="slds-col slds-size_5-of-12 slds-p-top_medium slds-align_absolute-center slds-size_small">
            <template if:true={element.value.showApprova}>
              <lightning-helptext  if:true={isSwitchHelptextActive} content="ATTENZIONE! La funzionalità di richiesta NDG è stata disabilitata. Contattare l'amministratore di sistema."></lightning-helptext>
            </template>

            <lightning-button class='button-verifica slds-size_small'
                                variant="brand"
                                flexibility="grow"
                                disabled={isSwitchActive}
                                padding="around-small"
                                if:true={element.value.showApprova}
                                label="Approva"
                                data-id={element.value.Id}
                                onclick={openModal}
                                name="approvaBtn" >
              </lightning-button>
          </div>

          <div class="slds-col slds-size_2-of-12 slds-size_small slds-p-around_small">
              <div if:true={element.value.showButtons}>
                  <lightning-button data-id="Elimina"
                                    label="Elimina"
                                    disabled={element.value.disableEliminaButton}
                                    onclick={removeFiles}
                                    name={element.value.Id}
                                    variant="brand"
                                    class="button-verifica slds-align_absolute-center">
                  </lightning-button>
									<!-- disabled={element.value.disableEliminaButton} -->
              </div>
          </div>

          <div class="slds-col slds-size_2-of-12 slds-size_small slds-p-around_small">
              <div if:true={element.value.showButtons}>
                  <lightning-button data-id="Sostituisci"
                                    label="Sostituisci"
                                    disabled={element.value.disableSostituisciButton}
                                    onclick={replaceFiles}
                                    name={element.value.Id}
                                    variant="brand"
                                    class="button-verifica slds-align_absolute-center">
                  </lightning-button>
              </div>
          </div>
        </div>
      </div>

      <template if:true={showFileNameModal}>
        <c-file-name-modal is-modal-open={showFileNameModal}
                           document-type-id={documentTypeId}
                           account-id={opportunity.AccountId}
                           opportunity={opportunity}
                           file-name={fileName}
                           file-id={fileId}
                           replace-doc-id={replaceFileId}
                           comment-to-save={commentToSave}
                           default-file-name={defaultFileName}
                           onfilenameupdated={handleFileNameUpdated}
                           onclosedmodal={handleClosedFileNameModal}
                           is-sostituisci={isSostituisci}>
        </c-file-name-modal>
      </template>
    </div>
  </template>

  <template if:true={isEliminaSostituisciModalOpen}>
    <c-modal-popup-lwc is-modal-open={isEliminaSostituisciModalOpen} record-id={recordId}
                       show-elimina= {showElimina} document-map={documentMap}
                       document-type={documentTypeToPass} onclosemodalevnt={closeEliminaSostituisciModal}
                       onuploadfinished={handleUploadFinished}>
    </c-modal-popup-lwc>
  </template>

  <template if:true={showSpinner} data-id="spinnerSectionModal" tabindex="-1"
            class="slds-modal slds-fade-in-open slds-backdrop mro-modal-small">
    <lightning-spinner alternative-text="Loading"
                       variant="brand"
                       size="large">
    </lightning-spinner>
  </template>
</template>

<!--                    <div class="slds-col slds-size_4-of-12 slds-p-top_medium slds-p-right_small slds-align_absolute-right slds-size_small" >-->
<!--                        <br/>-->
<!--                        <lightning-button class='button-notifica' variant="brand" if:true={type.showRichiediApprovazione} label="Richiedi Approvazione" id={type.Id} onclick={handleChange} name={type.Id} disabled={isRecTypeRO} ></lightning-button>-->
<!--                    </div>-->